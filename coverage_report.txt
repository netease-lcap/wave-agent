
 RUN  v3.2.4 /home/liuyiqi/personal-projects/wave-agent/packages/agent-sdk
      Coverage enabled with v8

ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทcยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทstdout | tests/plugin-loading-integration.test.ts > Agent Plugin Loading Integration > should load plugins from both user and project configurations and skip unmentioned ones
Loaded plugins: [ [32m'user'[39m, [32m'project'[39m ]

ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทcยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท

 Test Files  131 passed (131)
      Tests  1609 passed (1609)
   Start at  20:11:09
   Duration  13.02s (transform 2.28s, setup 0ms, collect 13.01s, tests 9.00s, environment 34ms, prepare 12.29s)

 % Coverage report from v8
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |   65.76 |    80.44 |   81.81 |   65.76 |                   
 examples          |       0 |    76.66 |   76.66 |       0 |                   
  ...validation.ts |       0 |      100 |     100 |       0 | 11-269            
  ...tools-demo.ts |       0 |      100 |     100 |       0 | 9-104             
  ...r-question.ts |       0 |      100 |     100 |       0 | 11-113            
  chrome-mcp.ts    |       0 |      100 |     100 |       0 | 3-143             
  ...sh-command.ts |       0 |      100 |     100 |       0 | 9-83              
  custom-tools.ts  |       0 |      100 |     100 |       0 | 3-223             
  ...rs-example.ts |       0 |        0 |       0 |       0 | 1-83              
  ...pose-agent.ts |       0 |        0 |       0 |       0 | 1-53              
  ...rs-example.ts |       0 |      100 |     100 |       0 | 10-74             
  hi.ts            |       0 |      100 |     100 |       0 | 3-102             
  ...e-blocking.ts |       0 |      100 |     100 |       0 | 18-264            
  ...onblocking.ts |       0 |      100 |     100 |       0 | 17-278            
  ...de-success.ts |       0 |      100 |     100 |       0 | 18-199            
  ...json-input.ts |       0 |      100 |     100 |       0 | 11-173            
  ...ules-basic.ts |       0 |      100 |     100 |       0 | 11-124            
  ...rules-demo.ts |       0 |      100 |     100 |       0 | 17-269            
  ...ution-demo.ts |       0 |        0 |       0 |       0 | 1-133             
  ...n-advanced.ts |       0 |      100 |     100 |       0 | 11-234            
  ...sion-basic.ts |       0 |      100 |     100 |       0 | 8-99              
  ...production.ts |       0 |      100 |     100 |       0 | 11-323            
  ...in-example.ts |       0 |        0 |       0 |       0 | 1-96              
  ...nv-example.ts |       0 |        0 |       0 |       0 | 1-281             
  ...it-example.ts |       0 |      100 |     100 |       0 | 3-73              
  ...image-demo.ts |       0 |      100 |     100 |       0 | 11-90             
  rewind-demo.ts   |       0 |      100 |     100 |       0 | 3-120             
  ...al-example.ts |       0 |      100 |     100 |       0 | 12-139            
  skillDemo.ts     |       0 |      100 |     100 |       0 | 3-95              
  ...-execution.ts |       0 |      100 |     100 |       0 | 3-248             
  ...lex-plugin.ts |       0 |        0 |       0 |       0 | 1-91              
  verify-plugin.ts |       0 |        0 |       0 |       0 | 1-85              
 src               |   78.57 |    78.02 |   63.23 |   78.57 |                   
  agent.ts         |   80.92 |     77.9 |   62.68 |   80.92 | ...1236-1237,1313 
  index.ts         |       0 |      100 |     100 |       0 | 2-35              
 src/constants     |     100 |    92.85 |     100 |     100 |                   
  prompts.ts       |     100 |    92.85 |     100 |     100 | 101               
  tools.ts         |     100 |      100 |     100 |     100 |                   
 src/managers      |    78.3 |    78.47 |   83.52 |    78.3 |                   
  ...uleManager.ts |   80.99 |       80 |   83.33 |   80.99 | ...41-142,162-163 
  aiManager.ts     |   87.66 |    79.47 |   84.21 |   87.66 | ...49-953,959-960 
  ...ashManager.ts |   65.03 |    60.86 |    87.5 |   65.03 | ...80-182,189-191 
  bashManager.ts   |     100 |    94.44 |     100 |     100 | 66                
  hookManager.ts   |   61.45 |    70.63 |      75 |   61.45 | ...35-781,787-796 
  ...figManager.ts |   75.99 |    76.29 |   85.71 |   75.99 | ...34-637,642-645 
  lspManager.ts    |   67.66 |    49.12 |    92.3 |   67.66 | ...09-410,419-421 
  mcpManager.ts    |   73.74 |    71.59 |    82.6 |   73.74 | ...00-515,523-532 
  ...ageManager.ts |    75.1 |    82.65 |    73.8 |    75.1 | ...14-715,767-770 
  ...ionManager.ts |   97.59 |    91.32 |   95.45 |   97.59 | ...70,597-598,605 
  planManager.ts   |   78.57 |       60 |     100 |   78.57 | 27-32             
  pluginManager.ts |   99.09 |    95.12 |     100 |   99.09 | 162               
  ...opeManager.ts |   46.57 |      100 |   28.57 |   46.57 | ...95-113,121-123 
  ...ionManager.ts |   88.54 |    81.25 |   85.71 |   88.54 | ...41-142,146-147 
  skillManager.ts  |   64.15 |    79.48 |   91.66 |   64.15 | ...33-236,322-334 
  ...andManager.ts |   89.72 |    81.66 |      95 |   89.72 | ...65-267,341-353 
  ...entManager.ts |   76.04 |    69.23 |   79.16 |   76.04 | ...22-527,563-570 
  toolManager.ts   |   86.84 |    77.77 |   88.88 |   86.84 | ...90,198-207,252 
 src/services      |   78.73 |    79.02 |   86.32 |   78.73 |                   
  GitService.ts    |   85.89 |    66.66 |     100 |   85.89 | ...81-84,89-90,95 
  ...aceService.ts |   81.11 |    66.21 |     100 |   81.11 | ...19,446,455-464 
  ...uleService.ts |   97.82 |    93.33 |     100 |   97.82 | 27                
  aiService.ts     |   75.67 |    78.78 |     100 |   75.67 | ...31-740,907-911 
  ...ionService.ts |   84.18 |    85.41 |      76 |   84.18 | ...96-899,991-999 
  fileWatcher.ts   |   51.59 |     64.7 |   66.66 |   51.59 | ...51-253,258-286 
  hook.ts          |    85.1 |    71.42 |     100 |    85.1 | ...26,158-160,185 
  jsonlHandler.ts  |   72.97 |    89.13 |      75 |   72.97 | ...04-207,210-213 
  memory.ts        |   92.18 |     86.2 |     100 |   92.18 | ...05-107,144-146 
  pluginLoader.ts  |   99.28 |    95.12 |     100 |   99.28 | 113               
  ...ionService.ts |   82.53 |    66.66 |     100 |   82.53 | 23-26,60-61,74-78 
  session.ts       |   70.46 |       72 |   77.77 |   70.46 | ...13-838,840-842 
 src/tools         |   75.82 |    79.92 |   74.19 |   75.82 |                   
  ...erQuestion.ts |   90.38 |     37.5 |     100 |   90.38 | 88-91,121-126     
  bashTool.ts      |   81.06 |    73.91 |     100 |   81.06 | ...76-481,508-513 
  ...teFileTool.ts |   63.46 |     64.7 |      50 |   63.46 | ...,94-95,121-126 
  editTool.ts      |   73.76 |    75.67 |      50 |   73.76 | ...09-210,232-240 
  exitPlanMode.ts  |   88.88 |    81.25 |     100 |   88.88 | 83-91             
  globTool.ts      |     100 |    91.66 |     100 |     100 | 118,133           
  grepTool.ts      |   93.58 |    91.04 |     100 |   93.58 | ...55,273-275,312 
  lsTool.ts        |   87.93 |       92 |     100 |   87.93 | 71-86,136-140     
  lspTool.ts       |   31.47 |       50 |   36.84 |   31.47 | ...41-646,649-660 
  multiEditTool.ts |   80.07 |    81.13 |      50 |   80.07 | ...82-283,307-315 
  readTool.ts      |    87.2 |    82.85 |     100 |    87.2 | ...88-289,302-305 
  skillTool.ts     |     100 |    93.75 |     100 |     100 | 78                
  taskTool.ts      |   71.92 |    66.66 |      75 |   71.92 | ...27-133,137-140 
  todoWriteTool.ts |   94.57 |    95.12 |     100 |   94.57 | 133-134,249-255   
  types.ts         |       0 |        0 |       0 |       0 |                   
  writeTool.ts     |   83.43 |    74.35 |     100 |   83.43 | ...44-145,169-177 
 src/types         |    96.8 |     93.1 |     100 |    96.8 |                   
  commands.ts      |       0 |        0 |       0 |       0 |                   
  config.ts        |       0 |        0 |       0 |       0 |                   
  configuration.ts |       0 |        0 |       0 |       0 |                   
  core.ts          |     100 |      100 |     100 |     100 |                   
  environment.ts   |   69.23 |       50 |     100 |   69.23 | 41-42,47-48       
  fileSearch.ts    |       0 |        0 |       0 |       0 |                   
  history.ts       |       0 |        0 |       0 |       0 |                   
  hooks.ts         |     100 |      100 |     100 |     100 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
  lsp.ts           |       0 |        0 |       0 |       0 |                   
  marketplace.ts   |       0 |        0 |       0 |       0 |                   
  mcp.ts           |       0 |        0 |       0 |       0 |                   
  memoryRule.ts    |       0 |        0 |       0 |       0 |                   
  messaging.ts     |     100 |      100 |     100 |     100 |                   
  permissions.ts   |     100 |      100 |     100 |     100 |                   
  plugins.ts       |       0 |        0 |       0 |       0 |                   
  processes.ts     |       0 |        0 |       0 |       0 |                   
  reversion.ts     |       0 |        0 |       0 |       0 |                   
  session.ts       |       0 |        0 |       0 |       0 |                   
  skills.ts        |     100 |      100 |     100 |     100 |                   
  tools.ts         |       0 |        0 |       0 |       0 |                   
 src/utils         |   82.09 |    84.29 |   86.62 |   82.09 |                   
  abortUtils.ts    |   82.35 |      100 |   85.71 |   82.35 | 68-82             
  bashParser.ts    |   88.97 |    85.39 |     100 |   88.97 | ...85-486,491-492 
  ...nSubagents.ts |     100 |      100 |     100 |     100 |                   
  ...ntrolUtils.ts |   81.78 |    84.26 |     100 |   81.78 | ...59-460,470-471 
  ...mentParser.ts |     100 |     97.5 |     100 |     100 | 37                
  ...thResolver.ts |   97.95 |    97.67 |     100 |   97.95 | 34-35             
  configPaths.ts   |   28.57 |      100 |   27.27 |   28.57 | ...37-139,156-170 
  ...gValidator.ts |   39.32 |       25 |     100 |   39.32 | ...02-107,114-119 
  constants.ts     |     100 |      100 |     100 |     100 |                   
  ...agesForAPI.ts |   83.42 |       75 |     100 |   83.42 | ...04,206-232,242 
  ...omCommands.ts |   94.84 |    90.47 |     100 |   94.84 | 74-76,126-127     
  editUtils.ts     |   44.82 |      100 |   33.33 |   44.82 | 19-80,86-87       
  fileFilter.ts    |   43.44 |       50 |   66.66 |   43.44 | ...64,180-181,184 
  fileFormat.ts    |     100 |      100 |     100 |     100 |                   
  fileSearch.ts    |       0 |        0 |       0 |       0 | 1-107             
  fileUtils.ts     |   78.37 |    83.33 |   66.66 |   78.37 | 13-37,154,159     
  globalLogger.ts  |     100 |      100 |     100 |     100 |                   
  hookMatcher.ts   |   95.09 |    91.07 |     100 |   95.09 | 49-50,94-95,173   
  ...downParser.ts |   90.75 |       75 |     100 |   90.75 | ...07,122-125,174 
  mcpUtils.ts      |   54.02 |    89.47 |      50 |   54.02 | ...77-116,122-129 
  ...Operations.ts |   93.58 |    84.14 |     100 |   93.58 | ...83-384,564-578 
  nameGenerator.ts |     100 |      100 |     100 |     100 |                   
  openaiClient.ts  |   95.42 |    81.81 |   85.71 |   95.42 | ...49,157,170,214 
  path.ts          |    93.5 |    93.75 |   66.66 |    93.5 | 83-86,116         
  pathEncoder.ts   |     100 |      100 |     100 |     100 |                   
  pathSafety.ts    |    91.3 |    66.66 |     100 |    91.3 | 38-39             
  promptHistory.ts |   82.29 |    70.37 |     100 |   82.29 | ...09-111,129-131 
  skillParser.ts   |   95.45 |    78.57 |     100 |   95.45 | 110,129,146-149   
  stringUtils.ts   |   65.85 |      100 |   66.66 |   65.85 | 17-38             
  ...gentParser.ts |   72.97 |    47.05 |   85.71 |   72.97 | ...76-179,221-227 
  ...alculation.ts |     100 |      100 |     100 |     100 |                   
-------------------|---------|----------|---------|---------|-------------------
ERROR: Coverage for lines (65.76%) does not meet global threshold (80%)
ERROR: Coverage for statements (65.76%) does not meet global threshold (80%)

โฏโฏโฏโฏโฏโฏ Unhandled Error โฏโฏโฏโฏโฏโฏโฏ
Error: Casting "BlockStatement" is not supported

  2 | import { resolve } from "path";
  3 | 
  4 | export default defineConfig(() => {
                                        ^
  5 |   // Check if running in CI environment - supports multiple CI environment variables
  6 |   const isCI = !!(process.env.CI === "true");
  7 | 

 โฏ resolveConfig ../../node_modules/.pnpm/vitest@3.2.4_@types+node@22.19.3_tsx@4.20.6_yaml@2.8.1/node_modules/vitest/dist/chunks/coverage.DL5VHqXY.js:4317:9
 โฏ V8CoverageProvider.updateThresholds ../../node_modules/.pnpm/vitest@3.2.4_@types+node@22.19.3_tsx@4.20.6_yaml@2.8.1/node_modules/vitest/dist/chunks/coverage.DL5VHqXY.js:4190:18
 โฏ V8CoverageProvider.reportThresholds ../../node_modules/.pnpm/vitest@3.2.4_@types+node@22.19.3_tsx@4.20.6_yaml@2.8.1/node_modules/vitest/dist/chunks/coverage.DL5VHqXY.js:4082:15
 โฏ V8CoverageProvider.generateReports ../../node_modules/.pnpm/@vitest+coverage-v8@3.2.4_vitest@3.2.4_@types+node@22.19.3_tsx@4.20.6_yaml@2.8.1_/node_modules/@vitest/coverage-v8/dist/provider.js:2630:4
 โฏ V8CoverageProvider.reportCoverage ../../node_modules/.pnpm/vitest@3.2.4_@types+node@22.19.3_tsx@4.20.6_yaml@2.8.1/node_modules/vitest/dist/chunks/coverage.DL5VHqXY.js:4070:3
 โฏ Vitest.reportCoverage ../../node_modules/.pnpm/vitest@3.2.4_@types+node@24.10.10_tsx@4.20.6_yaml@2.8.1/node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js:9892:4
 โฏ ../../node_modules/.pnpm/vitest@3.2.4_@types+node@24.10.10_tsx@4.20.6_yaml@2.8.1/node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js:9657:5
 โฏ Vitest.runFiles ../../node_modules/.pnpm/vitest@3.2.4_@types+node@24.10.10_tsx@4.20.6_yaml@2.8.1/node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js:9666:10
 โฏ Vitest.start ../../node_modules/.pnpm/vitest@3.2.4_@types+node@24.10.10_tsx@4.20.6_yaml@2.8.1/node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js:9554:18
 โฏ startVitest ../../node_modules/.pnpm/vitest@3.2.4_@types+node@24.10.10_tsx@4.20.6_yaml@2.8.1/node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js:10510:8




undefined
/home/liuyiqi/personal-projects/wave-agent/packages/agent-sdk:
โERR_PNPM_RECURSIVE_EXEC_FIRST_FAILโ Command failed with exit code 1: vitest run --coverage
