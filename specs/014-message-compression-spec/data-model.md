# Data Model: Message Compression

## Entities

### CompressBlock
Used in assistant messages to store the summary of compressed history.

| Field | Type | Description |
|-------|------|-------------|
| `type` | 'compress' | Identifies the block as a compression summary. |
| `content` | string | The summary text generated by the AI. |

### LongTextEntry
Used in `InputManager` to track compressed user inputs.

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | The placeholder ID (e.g., `[LongText#1]`). |
| `originalText` | string | The full text that was pasted. |

## State Transitions

### History Compression
1. **Monitoring**: `AIManager` checks token usage after each response.
2. **Triggered**: Usage exceeds threshold; `getMessagesToCompress` is called.
3. **Summarizing**: AI generates a summary of the selected messages.
4. **Compressed**: Original messages are replaced by a `CompressBlock`.

### Input Compression
1. **Pasting**: User pastes text > 200 characters.
2. **Placeholder Created**: Text is stored in `longTextMap`, placeholder is inserted into input.
3. **Submission**: User sends the message.
4. **Expansion**: Placeholders are replaced with `originalText` before sending to agent.
5. **Cleanup**: `longTextMap` is cleared.
