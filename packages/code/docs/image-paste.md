# 图片粘贴功能

## 功能概述

InputBox 现在支持通过 `Ctrl+V` 快捷键粘贴剪贴板中的图片。这使得用户可以方便地将图片与文本一起发送给 AI。

## 使用方法

1. **复制图片到剪贴板**：
   - 截图 (Cmd+Shift+4 on macOS, Win+Shift+S on Windows)
   - 从文件管理器复制图片文件
   - 从网页或应用程序复制图片

2. **粘贴图片**：
   - 在 InputBox 中按 `Ctrl+V`
   - 图片会显示为 `[Image #1]` 占位符
   - 支持连续粘贴多张图片：`[Image #1][Image #2]`

3. **查看附加的图片**：
   - 粘贴图片后会显示附加图片列表
   - 显示格式：`📎 Attached Images: • [Image #1] (image/png)`

4. **发送消息**：
   - 输入文本消息（可选）
   - 按 Enter 发送
   - 图片数据会自动传递给 AI
   - 发送后图片列表会自动清空

## 技术实现

### 核心组件

- **useImageManager**: 管理附加图片的状态
- **useClipboardPaste**: 处理剪贴板图片读取
- **useInputKeyboardHandler**: 集成 Ctrl+V 快捷键
- **InputBox**: 显示图片占位符和附加列表

### 消息格式

发送的消息包含：

- 文本内容（移除图片占位符后）
- 图片数组：`[{path: string, mimeType: string}]`

### 支持的图片格式

- PNG
- JPEG/JPG
- 其他剪贴板支持的图片格式

## 测试覆盖

- 图片粘贴功能测试
- 多图片支持测试
- 失败情况处理测试
- 消息发送集成测试
- 图片清理功能测试

## 错误处理

- 剪贴板为空时静默失败
- 非图片内容时不显示占位符
- 读取失败时在控制台显示警告
- 不影响现有功能的正常使用

## 键盘快捷键

| 快捷键   | 功能                           |
| -------- | ------------------------------ |
| `Ctrl+V` | 粘贴剪贴板图片                 |
| `Enter`  | 发送消息（包含图片）           |
| `Esc`    | 取消选择器（不影响已粘贴图片） |

## 与现有功能的集成

- 完全兼容文件选择器 (`@` 功能)
- 完全兼容命令选择器 (`/` 功能)
- 完全兼容 Bash 历史选择器 (`!` 功能)
- 支持历史记录导航
- 支持光标移动和编辑
